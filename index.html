<html lang="en">
  <head>
    <title>Hearts</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>

    <link
      href="//fonts.googleapis.com/css?family=Raleway:400,300,600"
      rel="stylesheet"
      type="text/css"
    />

    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/skeleton.css" />
  </head>
  <body>
    <div class="container" style="padding-top: 50px;">
      <div class="twelve columns">
        <div class="row">
          <p>
            <a href="https://jessemillar.com">Jesse Millar</a> likes playing
            cards. He currently owns [number] decks.
          </p>
          <p>
            If you're looking for a good gift for Jesse, a deck of playing cards
            is always a safe bet. Use the content below to peruse his current
            collection. He prefers decks from Art of Play and theory11 for their
            superior quality and design, but will happily accept any deck,
            novelty or otherwise. Duplicate decks often make him as happy as new
            decks.
          </p>
        </div>
      </div>

      <div class="twelve columns">
        <div class="row">
          <input
            class="u-full-width"
            type="text"
            placeholder="Search deck name or description"
            id="search"
          />
        </div>
      </div>

      <div class="row">
        <div class="twelve columns">
          <table class="u-full-width">
            <thead>
              <tr>
                <th>Name</th>
                <th>Desc.</th>
                <th>Owned</th>
                <th>Preview</th>
              </tr>
            </thead>
            <tbody id="results"></tbody>
          </table>
        </div>
      </div>
    </div>
  </body>

  <script>
    var database = null;

    $.ajax({
      url: "decks.json",
      dataType: "json",
      success: function(data) {
        database = data;
        showAllDecks();
      }
    });

    $("#search").keyup(function() {
      var searchField = $(this).val();
      if (searchField === "") {
        showAllDecks();
        return;
      }

      var regex = new RegExp(searchField, "i");
      var output = "";
      if (database.length > 0) {
        $.each(database, function(key, val) {
          if (
            val.name.search(regex) != -1 ||
            val.description.search(regex) != -1
          ) {
            output += getDeckHTML(val);
          }
        });
        $("#results").html(output);
      }
    });

    function showAllDecks() {
      var output = "";
      $.each(database, function(key, val) {
        output += getDeckHTML(val);
      });
      $("#results").html(output);
    }

    function getDeckHTML(deck) {
      var output = "";
      output += "<tr>";
      output += "<td>" + deck.name + "</td>";
      output += "<td>" + deck.description + "</td>";
      output += "<td>" + deck.owned + "</td>";
      output +=
        '<td><a href="' +
        deck.image +
        '"><img class="u-max-full-width" src="' +
        deck.image +
        '" alt="' +
        deck.name +
        '" /></a></td>';
      output += "<tr>";
      return output;
    }
  </script>
</html>
